!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){window,t.exports=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e),n.d(e,"AudioGenerator",function(){return d}),n.d(e,"SoundGenerator",function(){return h}),n.d(e,"MusicGenerator",function(){return l});var o=2,i=33,r=null;function a(t){return Math.sin(6.283184*t)}var s=[a,function(t){return a(t)<0?-1:1},function(t){return t%1-.5},function(t){var e=t%1*4;return e<2?e-1:3-e}];function u(t){return.00390625*Math.pow(1.059463094,t-128)}function c(t,e){setTimeout(function(){var n=new Uint8Array(t*o*2),r=n.length-2,a=function(){for(var t=new Date,o=0;r>=0;)if(n[r]=0,n[r+1]=128,r-=2,(o+=1)%1e3==0&&new Date-t>i)return void setTimeout(a,0);setTimeout(function(){e(n)},0)};setTimeout(a,0)},0)}function f(t,e,n,o,r){var a=n.fx_delay_time*o>>1,s=n.fx_delay_amt/255,u=0,c=function(){for(var n=new Date,o=0;u<e-a;){var f=4*u,d=4*(u+a),h=t[d]+(t[d+1]<<8)+(t[f+2]+(t[f+3]<<8)-32768)*s;if(t[d]=255&h,t[d+1]=h>>8&255,h=t[d+2]+(t[d+3]<<8)+(t[f]+(t[f+1]<<8)-32768)*s,t[d+2]=255&h,t[d+3]=h>>8&255,++u,(o+=1)%1e3==0&&new Date-n>i)return void setTimeout(c,0)}setTimeout(r,0)};setTimeout(c,0)}var d=function(t){this.mixBuf=t,this.waveSize=t.length/o/2};d.prototype.getWave=function(){var t,e,n,i,r,a,s,u=this.mixBuf,c=this.waveSize*o*2;for(a=(r=c-8)-36,i=String.fromCharCode(82,73,70,70,255&r,r>>8&255,r>>16&255,r>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),t=0;t<c;){for(n="",e=0;e<256&&t<c;++e,t+=2)s=(s=4*(u[t]+(u[t+1]<<8)-32768))<-32768?-32768:s>32767?32767:s,n+=String.fromCharCode(255&s,s>>8&255);i+=n}return i},d.prototype.getAudio=function(){var t=this.getWave(),e=new Audio("data:audio/wav;base64,"+btoa(t));return e.preload="none",e.load(),e},d.prototype.getAudioBuffer=function(t){null===r&&(r=new AudioContext);var e=this.mixBuf,n=this.waveSize,a=r.createBuffer(o,this.waveSize,44100),s=a.getChannelData(0),u=a.getChannelData(1),c=0,f=function(){for(var o=new Date,r=0;c<n;){var d=4*(e[4*c]+(e[4*c+1]<<8)-32768);if(d=d<-32768?-32768:d>32767?32767:d,s[c]=d/32768,d=(d=4*(e[4*c+2]+(e[4*c+3]<<8)-32768))<-32768?-32768:d>32767?32767:d,u[c]=d/32768,c+=1,(r+=1)%1e3==0&&new Date-o>i)return void setTimeout(f,0)}setTimeout(function(){t(a)},0)};setTimeout(f,0)};var h=function(t,e){this.instr=t,this.rowLen=e||5605,this.osc_lfo=s[t.lfo_waveform],this.osc1=s[t.osc1_waveform],this.osc2=s[t.osc2_waveform],this.attack=t.env_attack,this.sustain=t.env_sustain,this.release=t.env_release,this.panFreq=Math.pow(2,t.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,t.lfo_freq-8)/this.rowLen};h.prototype.genSound=function(t,e,n){new Date;for(var o=0,i=0,r=u(t+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),s=u(t+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),c=this.instr.fx_resonance/255,f=0,d=0,h=this.attack+this.sustain+this.release-1;h>=0;--h){var l=h+n,v=this.osc_lfo(l*this.lfoFreq)*this.instr.lfo_amt/512+.5,g=1;h<this.attack?g=h/this.attack:h>=this.attack+this.sustain&&(g-=(h-this.attack-this.sustain)/this.release);var m=r;this.instr.lfo_osc1_freq&&(m+=v),this.instr.osc1_xenv&&(m*=g*g),o+=m;var p=this.osc1(o)*this.instr.osc1_vol;m=s,this.instr.osc2_xenv&&(m*=g*g),i+=m,p+=this.osc2(i)*this.instr.osc2_vol,this.instr.noise_fader&&(p+=(2*Math.random()-1)*this.instr.noise_fader*g),p*=g/255;var w=this.instr.fx_freq;this.instr.lfo_fx_freq&&(w*=v);var x=c*(p-d)-(f+=(w=1.5*Math.sin(3.141592*w/44100))*d);switch(d+=w*x,this.instr.fx_filter){case 1:p=x;break;case 2:p=f;break;case 3:p=d;break;case 4:p=f+x}if(m=a(l*this.panFreq)*this.instr.fx_pan_amt/512+.5,p*=39*this.instr.env_master,3+(l*=4)<e.length){var y=e[l]+(e[l+1]<<8)+p*(1-m);e[l]=255&y,e[l+1]=y>>8&255,y=e[l+2]+(e[l+3]<<8)+p*m,e[l+2]=255&y,e[l+3]=y>>8&255}}},h.prototype.getAudioGenerator=function(t,e){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,o=this;c(n,function(i){o.genSound(t,i,0),f(i,n,o.instr,o.rowLen,function(){e(new d(i))})})},h.prototype.createAudio=function(t,e){this.getAudioGenerator(t,function(t){e(t.getAudio())})},h.prototype.createAudioBuffer=function(t,e){this.getAudioGenerator(t,function(t){t.getAudioBuffer(e)})};var l=function(t){this.song=t,this.waveSize=44100*t.songLen};l.prototype.generateTrack=function(t,e,n){var r=this;c(this.waveSize,function(a){var s=r.waveSize,u=r.waveSize*o*2,c=r.song.rowLen,d=r.song.endPattern,l=new h(t,c),v=0,g=0,m=0,p=function(){for(var e=new Date;;)if(32!==m){if(g===d-1)return void setTimeout(w,0);var n=t.p[g];if(n){var o=t.c[n-1].n[m];o&&l.genSound(o,a,v)}if(v+=c,m+=1,new Date-e>i)return void setTimeout(p,0)}else m=0,g+=1},w=function(){f(a,s,t,c,y)},x=0,y=function(){for(var t=new Date,o=0;x<u;){var r=e[x]+(e[x+1]<<8)+a[x]+(a[x+1]<<8)-32768;if(e[x]=255&r,e[x+1]=r>>8&255,x+=2,(o+=1)%1e3==0&&new Date-t>i)return void setTimeout(y,0)}setTimeout(n,0)};setTimeout(p,0)})},l.prototype.getAudioGenerator=function(t){var e=this;c(this.waveSize,function(n){var o=0,i=function(){o<e.song.songData.length?(o+=1,e.generateTrack(e.song.songData[o-1],n,i)):t(new d(n))};i()})},l.prototype.createAudio=function(t){this.getAudioGenerator(function(e){t(e.getAudio())})},l.prototype.createAudioBuffer=function(t){this.getAudioGenerator(function(e){e.getAudioBuffer(t)})}}])},function(t,e,n){"use strict";n.r(e);const o=new AudioContext,i=(t,e,n,i=1,r=.1,a=0,s=0,u=0,c=0)=>{let f=44100,d=Math.PI;n*=2*d/f,n*=1+e*(2*Math.random()-1),a*=1e3*d/f**2,r*=0|(i=0<i?f*(10<i?10:i)|0:1),u*=2*d/f,c*=d,e=[];for(var h=0,l=0,v=0;v<i;++v)e[v]=.5*t*Math.cos(h*n*Math.cos(l*u+c))*(v<r?v/r:1-(v-r)/(i-r)),h+=1+s*(2*Math.random()-1),l+=1+s*(2*Math.random()-1),n+=a;return t=o.createBuffer(1,i,f),n=o.createBufferSource(),t.getChannelData(0).set(e),n.buffer=t,n.connect(o.destination),n.start(),n};n(0);function r(t,e,n){let o=t.getContext("2d"),i=window.innerWidth,r=window.innerHeight;Math.max(i/e,r/n);var a=Math.min(i/e,r/n);t.style.width=i+"px",t.style.height=r+"px",t.width=i,t.height=r;let s=i/2-e/2*a,u=r/2-n/2*a;return o.setTransform(a,0,0,a,s,u),{canvas:t,nativeWidth:e,nativeHeight:n}}Math.PI;function a(...t){if(4==t.length)return function(t,e,n,o){let i=n-t,r=o-e;return Math.sqrt(i**2+r**2)}(...t);if(2==t.length)return function(t,e){let n=e.x-t.x,o=e.y-t.y;return Math.sqrt(n**2+o**2)}(...t);throw"ERROR: Pass 4 numbers for cordinates or 2 objects with x,y props"}const s=t=>t*Math.PI/180;function u(t){return t.toUpperCase().charCodeAt(0)-46}function c(t,e,n,o,i=1,r="text_spritesheet.png"){let a=new Image;a.src=r;let s=t.getContext("2d");s.save(),s.scale(i,i);let c=function(t){return t.split("").map(u)}(e);for(let t=0;t<c.length;t++){const e=c[t];s.drawImage(a,16*e,0,16,16,n+16*t,o/i,16,16)}s.restore()}function f(t,e,n,o){let i=new Image;i.src=`${o}`;return{conf:t,x:e,y:n,rotation:0,img:i}}function d(t,e,n,o,i){return{...t,dx:e,dy:n,type:o,radius:i,rotation:Math.floor(360*Math.random()),innerRotation:0,alive:!0}}function h(t){t.forEach(t=>{!function(t){if(!t.alive)return;const{conf:e}=t;t.conf.bullets.forEach(e=>{a(t,e)<=16&&(t.alive=!1)}),t.innerRotation-=2,t.x+=Math.cos(s(t.rotation))*(1*t.dx),t.y+=Math.sin(s(t.rotation))*(1*t.dy),t.x>=e.nativeWidth-32&&(t.x=e.nativeWidth-32,t.dx*=-1),t.x<=0&&(t.x=0,t.dx*=-1),t.y>=e.nativeHeight-32&&(t.y=e.nativeHeight-32,t.dy*=-1),t.y<=0&&(t.y=0,t.dy*=-1)}(t)})}function l(t){t.forEach(t=>{!function(t){const e=t.conf.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1;const{x:n,y:o,innerRotation:i,type:r}=t,a=n+16,s=o+16;switch(e.save(),e.translate(a,s),e.rotate(Math.PI/180*i),e.translate(-a,-s),r){case"methane":e.drawImage(t.img,80,0,16,16,n,o,16,16),e.drawImage(t.img,96,0,16,16,n+16,o,16,16),e.drawImage(t.img,112,0,16,16,n,o+16,16,16),e.drawImage(t.img,128,0,16,16,n+16,o+16,16,16);break;case"dioxide":e.drawImage(t.img,144,0,16,16,n,o,16,16),e.drawImage(t.img,160,0,16,16,n+16,o,16,16),e.drawImage(t.img,176,0,16,16,n,o+16,16,16),e.drawImage(t.img,192,0,16,16,n+16,o+16,16,16)}e.restore()}(t)})}document.getElementById("testbtn").addEventListener("click",()=>{});const v=document.getElementsByTagName("canvas")[0],g=v.getContext("2d");let m=0;const p=2;let w,x=!1,y=!1,b=(new Date).getTime();const _=b,M=6e4;let S=6e4,I=2;const T=5;let k,A=!1;const C={...r(v,640,360),molecules:[],bullets:[]};r(v,C.nativeWidth,C.nativeHeight),window.addEventListener("resize",()=>{r(v,C.nativeWidth,C.nativeHeight)}),window.addEventListener("gamepadconnected",t=>{console.log("Gamepad connected at index %d: %s. %d buttons, %d axes.",t.gamepad.index,t.gamepad.id,t.gamepad.buttons.length,t.gamepad.axes.length),A=!0});const E=function(t,e,n,o=!1,i=!1){return{...t,dx:e,dy:n,turnLeft:o,turnRight:i,alive:!0}}(f(C,C.nativeWidth/2,C.nativeHeight/2,"spritesheet.png"),2,2);function L(t,e){const n=function(t,e,n,o){return{...t,rotation:o,dx:e,dy:n,alive:!0}}(f(C,e.x+5,e.y+6,"spritesheet.png"),2,2,e.rotation);t.push(n)}function D(t){t.forEach(t=>{!function(t){if(!t.alive)return;const e=t.conf.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1;const{x:n,y:o,rotation:i}=t,r=n+1.5,a=o+.5;e.save(),e.translate(r,a),e.rotate(Math.PI/180*i),e.translate(-r,-a),e.drawImage(t.img,24,0,1,16,n,o,8,3),e.restore()}(t)})}function P(t){t.forEach(t=>{!function(t){t.alive?(t.x+=Math.cos(s(t.rotation))*(t.dx*p+1),t.y+=Math.sin(s(t.rotation))*(t.dy*p+1),t.x>=C.nativeWidth-8&&(t.x=C.nativeWidth-8,t.alive=!1),t.x<=0&&(t.x=0,t.alive=!1),t.y>=C.nativeHeight-8&&(t.y=C.nativeHeight-8,t.alive=!1),t.y<=0&&(t.y=0,t.alive=!1)):t=null}(t)})}const W=(O=f(C,16,8,"spritesheet.png"),j=T,G=I,{...O,current:j,goal:G});var O,j,G;const R=function(t,e,n){return{...t,impulse:e,maxImpulse:n}}(f(C,525,8,"spritesheet.png"),m,p);var H;H=E,window.addEventListener("keydown",t=>{const e=t.keyCode;switch(e){case 39:H.turnRight=!0;break;case 37:H.turnLeft=!0;break;case 32:i(1,.1,1495,.2,.25,.1,.1,9.7,.98),L(C.bullets,H)}38==e&&(i(1,.1,20,1,.07,.9,4.7,.3,.69),x=!0),40==e&&(y=!0)}),window.addEventListener("keyup",t=>{const e=t.keyCode;switch(e){case 39:H.turnRight=!1;break;case 37:H.turnLeft=!1}38==e&&(x=!1),40==e&&(y=!1)}),window.addEventListener("gamepadconnected",t=>{const e=navigator.getGamepads()[t.gamepad.index];!function(...t){window.LOGGER&&console.log(...t)}("Gamepad connected at index %d: %s. %d buttons, %d axes.",e.index,e.id,e.buttons.length,e.axes.length)}),function(t,e){for(let n=0;n<e;n++){const e=f(t,Math.random()*t.nativeWidth,Math.random()*t.nativeHeight,"spritesheet.png");t.molecules.push(d(e,1,1,Math.random()>=.5?"methane":"dioxide",16))}}(C,5),function t(){if(requestAnimationFrame(t),g.clearRect(0,-0,C.nativeWidth,C.nativeHeight),(w=(new Date).getTime())-b>=1e3&&(S=M-(w-_),b=w),A){const t=(k=navigator.getGamepads())[0],e=t.buttons[14],n=t.buttons[15],o=t.buttons[12],i=t.buttons[13],r=t.buttons[0];e.pressed?E.turnLeft=!0:E.turnLeft=!1,n.pressed?E.turnRight=!0:E.turnRight=!1,x=!!o.pressed,y=!!i.pressed,r.pressed&&L(C.bullets,E)}var e,n,o;!function(t){t.alive&&(t.conf.molecules.forEach(e=>{a(t,e)<=16&&(t.alive=!1)}),t.turnRight?t.rotation=t.rotation<360?t.rotation+=2:t.rotation=0:t.turnLeft&&(t.rotation=t.rotation>0?t.rotation-=2:t.rotation=360),t.x+=Math.cos(s(t.rotation))*(t.dx*m),t.y+=Math.sin(s(t.rotation))*(t.dy*m),t.x>=C.nativeWidth-16&&(t.x=C.nativeWidth-16),t.x<=0&&(t.x=0),t.y>=C.nativeHeight-16&&(t.y=C.nativeHeight-16),t.y<=0&&(t.y=0))}(E),function(t){if(!t.alive)return;const e=t.conf.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1;const{x:n,y:o,rotation:i}=t,r=n+8,a=o+8;e.save(),e.translate(r,a),e.rotate(Math.PI/180*i),e.translate(-r,-a),e.drawImage(t.img,0,0,16,16,n,o,16,16),e.restore()}(E),P(C.bullets),D(C.bullets),h(C.molecules),l(C.molecules),c(C.canvas,(e=S,n=Math.floor(e/6e4),o=(e%6e4/1e3).toFixed(0),n+":"+(o<10?"0":"")+o),C.nativeWidth/2-48,8,1),function(t){const e=t.conf.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1;const{x:n,y:o}=t;e.save(),e.drawImage(t.img,24,0,1,16,n,o,100,16),e.drawImage(t.img,38,0,1,16,n,o,100*I/T,16),c(t.conf.canvas,"oxygen",n+220,o+4,.5),e.restore()}(W),function(t){const e=t.conf.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1;const{x:n,y:o}=t;e.save(),e.drawImage(t.img,24,0,1,16,n,o,100,16),e.drawImage(t.img,54,0,1,16,n,o,100*m/p,16),c(t.conf.canvas,"impulse",n+408,o+4,.5),e.restore()}(R),x&&(m+=.02)>=p&&(m=p),y&&(m*=.98)<=0&&(m=0),g.save(),g.lineWidth=1,g.strokeStyle="purple",g.strokeRect(0,0,C.nativeWidth,C.nativeHeight),g.restore()}()}]);
//# sourceMappingURL=bundle.js.map